var __reflect=this&&this.__reflect||function(t,e,a){t.__class__=e,a?a.push(e):a=[e],t.__types__=t.__types__?a.concat(t.__types__):a},__extends=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);a.prototype=e.prototype,t.prototype=new a},__awaiter=this&&this.__awaiter||function(t,e,a,n){return new(a||(a=Promise))(function(i,r){function o(t){try{p(n.next(t))}catch(e){r(e)}}function s(t){try{p(n["throw"](t))}catch(e){r(e)}}function p(t){t.done?i(t.value):new a(function(e){e(t.value)}).then(o,s)}p((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function a(t){return function(e){return n([t,e])}}function n(a){if(i)throw new TypeError("Generator is already executing.");for(;p;)try{if(i=1,r&&(o=r[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return p.label++,{value:a[1],done:!1};case 5:p.label++,r=a[1],a=[0];continue;case 7:a=p.ops.pop(),p.trys.pop();continue;default:if(o=p.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){p=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){p.label=a[1];break}if(6===a[0]&&p.label<o[1]){p.label=o[1],o=a;break}if(o&&p.label<o[2]){p.label=o[2],p.ops.push(a);break}o[2]&&p.ops.pop(),p.trys.pop();continue}a=e.call(t,p)}catch(n){a=[6,n],r=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var i,r,o,s,p={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},RequiredElementManagement=function(){function t(t){this.container=t;for(var e=0;e<GameData.RequiredElements.length;e++){var a=new RequiredElement;this.container.addChildAt(a,e)}this.init()}return t.prototype.init=function(){for(var t=0;t<GameData.RequiredElements.length;t++){var e=this.container.getChildAt(t);e.setType(GameData.RequiredElements[t].type),e.setReqNum(GameData.RequiredElements[t].num),e.setX(t)}},t.prototype.isRequiredElementType=function(t){for(var e=this.container.numChildren,a=0;e>a;a++)if(this.container.getChildAt(a).getType()==t)return!0;return!1},t.prototype.getPointByType=function(t){for(var e=new egret.Point,a=this.container.numChildren,n=0;a>n;n++)if(this.container.getChildAt(n).getType()==t)return e.x=this.container.getChildAt(n).x+this.container.getChildAt(n).width/2,e.y=this.container.getChildAt(n).y,e},t.prototype.updateNumText=function(t,e){for(var a=0;a<this.container.numChildren;a++)if(this.container.getChildAt(a).getType()==t){var n=this.container.getChildAt(a).getReqNum();0>=n-e?this.container.getChildAt(a).setReqNum(0):this.container.getChildAt(a).setReqNum(n-e);break}},t.prototype.isAllElementEliminated=function(){for(var t=this.container.numChildren,e=0;t>e;e++)if(this.container.getChildAt(e).getReqNum()>0)return!1;return!0},t}();__reflect(RequiredElementManagement.prototype,"RequiredElementManagement");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var GameData=function(){function t(){}return t.GameElementTypes=["Egret-iOS-Support","EgretEngine","EgretWing","EgretFeather","DragonBones","EgretNative","Lakeshore","Egret-Android-Support","TextureMerger","EgretiaServer","EgretUIEditor","EgretInspector","EgretPro","ResDepot"],t.RequiredElements=[{type:"EgretNative",num:10},{type:"EgretWing",num:14},{type:"DragonBones",num:12},{type:"EgretFeather",num:10}],t.PropElements=[{type:"single",num:5},{type:"same",num:12},{type:"column",num:5},{type:"cross",num:10},{type:"line",num:14}],t}();__reflect(GameData.prototype,"GameData");var MapData=function(){function t(){}return t.maxRow=8,t.maxCol=8,t}();__reflect(MapData.prototype,"MapData");var CustomizedEvent=function(t){function e(e,a,n){return void 0===a&&(a=!1),void 0===n&&(n=!1),t.call(this,e,a,n)||this}return __extends(e,t),e.TAP_TWO_ELEMENT="tap_two_element",e.SWAP_ELEMENT="swap_element",e.ELIMINATE_OVER="eliminate_over",e.AUTO_ELIMINATE="auto_eliminate",e.USE_PROP_CLICK="use_prop_click",e.currentTap=-1,e.anotherTap=-1,e}(egret.Event);__reflect(CustomizedEvent.prototype,"CustomizedEvent");var GameElementManagement=function(t){function e(e){var a=t.call(this)||this;return a.swapElementNum=0,a.eliminateNum=0,a.moveLocElementNum=0,a.container=e,a}return __extends(e,t),e.prototype.createElements=function(){this.container.removeChildren();for(var t=(MapData.maxRow*MapData.maxCol,0);t<MapData.maxRow;t++)for(var e=0;e<MapData.maxCol;e++){var a="",n=!0,i="",r="";for(t>1&&this.container.getChildAt((t-1)*MapData.maxRow+e).getType()==this.container.getChildAt((t-2)*MapData.maxRow+e).getType()&&(i=this.container.getChildAt((t-1)*MapData.maxRow+e).getType()),e>1&&this.container.getChildAt(t*MapData.maxRow+e-1).getType()==this.container.getChildAt(t*MapData.maxRow+e-2).getType()&&(r=this.container.getChildAt(t*MapData.maxRow+e-1).getType());n;)a=this.getRandomType(),a!=i&&a!=r&&(n=!1);var o=new GameElement,s=t*MapData.maxRow+e;this.container.addChildAt(o,s),o.setType(a),o.show(s),o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),o.addEventListener(CustomizedEvent.SWAP_ELEMENT,this.swapElementHandler,this),o.addEventListener(CustomizedEvent.ELIMINATE_OVER,this.onEliminateOver,this),o.addEventListener(CustomizedEvent.AUTO_ELIMINATE,this.autoEliminate,this)}this.isHaveSeries()||this.disOrder()},e.prototype.getRandomType=function(){var t=Math.floor(Math.random()*GameData.GameElementTypes.length);return GameData.GameElementTypes[t]},e.prototype.onTouchTap=function(t){var e=t.currentTarget;if(""==PropElementManagement.propType)if(-1==CustomizedEvent.currentTap)e.focusEffect(!0),CustomizedEvent.currentTap=this.container.getChildIndex(e);else if(CustomizedEvent.currentTap==this.container.getChildIndex(e))e.focusEffect(!1),CustomizedEvent.currentTap=-1;else{CustomizedEvent.anotherTap=this.container.getChildIndex(e);var a=new CustomizedEvent(CustomizedEvent.TAP_TWO_ELEMENT);this.dispatchEvent(a)}else{-1!=CustomizedEvent.currentTap&&this.container.getChildAt(CustomizedEvent.currentTap).focusEffect(!1),CustomizedEvent.currentTap=this.container.getChildIndex(e);var a=new CustomizedEvent(CustomizedEvent.USE_PROP_CLICK);this.dispatchEvent(a)}},e.prototype.canMove=function(){var t=Math.floor(CustomizedEvent.currentTap/MapData.maxCol),e=Math.floor(CustomizedEvent.anotherTap/MapData.maxCol),a=CustomizedEvent.currentTap%MapData.maxRow,n=CustomizedEvent.anotherTap%MapData.maxRow;return t==e&&1==Math.abs(a-n)?!0:a==n&&1==Math.abs(t-e)?!0:!1},e.prototype.playSwapElement=function(){this.container.getChildAt(CustomizedEvent.currentTap).moveTo(CustomizedEvent.anotherTap),this.container.getChildAt(CustomizedEvent.anotherTap).moveTo(CustomizedEvent.currentTap)},e.prototype.swapElementHandler=function(t){this.swapElementNum++,2==this.swapElementNum&&(this.swapElementNum=0,this.dispatchEvent(t))},e.prototype.collectEliminates=function(){this.eliminates=[];for(var t=0;t<MapData.maxRow;t++){for(var e="",a=0,n=0;n<MapData.maxCol;n++)if(e==this.container.getChildAt(t*MapData.maxRow+n).getType())a++;else{if(a>=3)for(var i=0;a>i;i++)-1==this.eliminates.indexOf(t*MapData.maxRow+n-i-1)&&this.eliminates.push(t*MapData.maxRow+n-i-1);e=this.container.getChildAt(t*MapData.maxRow+n).getType(),a=1}if(a>=3)for(var i=0;a>i;i++)-1==this.eliminates.indexOf(t*MapData.maxRow+MapData.maxCol-i-1)&&this.eliminates.push(t*MapData.maxRow+MapData.maxCol-i-1)}for(var t=0;t<MapData.maxRow;t++){for(var e="",a=0,n=0;n<MapData.maxCol;n++)if(e==this.container.getChildAt(n*MapData.maxCol+t).getType())a++;else{if(a>=3)for(var i=0;a>i;i++)-1==this.eliminates.indexOf((n-i-1)*MapData.maxCol+t)&&this.eliminates.push((n-i-1)*MapData.maxCol+t);e=this.container.getChildAt(n*MapData.maxCol+t).getType(),a=1}if(a>=3)for(var i=0;a>i;i++)-1==this.eliminates.indexOf((MapData.maxRow-i-1)*MapData.maxCol+t)&&this.eliminates.push((MapData.maxRow-i-1)*MapData.maxCol+t)}},e.prototype.playMoveToRequiredElement=function(t,e){this.eliminateNum++;var a=this.container.getChildAt(t);a.moveToRequiredElement(e)},e.prototype.playScaleAndRemove=function(t){this.eliminateNum++;var e=this.container.getChildAt(t);e.scaleAndRemove()},e.prototype.onEliminateOver=function(t){this.eliminateNum--,0==this.eliminateNum&&this.dispatchEvent(t)},e.prototype.dropDownAndNewElement=function(){for(var t=0;t<MapData.maxCol;t++)for(var e=MapData.maxRow-1,a=0;e>=a+1;)if(""==this.container.getChildAt(e*MapData.maxRow+t).getType()){for(var n=e;n>=1;n--)this.container.swapChildren(this.container.getChildAt(n*MapData.maxRow+t),this.container.getChildAt((n-1)*MapData.maxRow+t));a++}else e--;for(var i=MapData.maxRow*MapData.maxCol,t=0;i>t;t++){var r=this.container.getChildAt(t);""==r.getType()?(r.setType(this.getRandomType()),r.dropDown(this.container.getChildIndex(r))):r.moveDown(this.container.getChildIndex(r))}},e.prototype.autoEliminate=function(t){if(this.moveLocElementNum++,this.moveLocElementNum==MapData.maxRow*MapData.maxCol){this.moveLocElementNum=0;var e=new CustomizedEvent(CustomizedEvent.AUTO_ELIMINATE);this.dispatchEvent(e)}},e.prototype.isHaveSeries=function(){for(var t=0;t<MapData.maxRow;t++)for(var e=0;e<MapData.maxCol;e++){var a=this.container.getChildAt(t*MapData.maxRow+e);if(e<MapData.maxCol-1&&a.getType()==this.container.getChildAt(t*MapData.maxRow+e+1).getType()){if(e>0){if(t>0&&a.getType()==this.container.getChildAt((t-1)*MapData.maxRow+e-1).getType())return!0;if(t<MapData.maxRow-1&&a.getType()==this.container.getChildAt((t+1)*MapData.maxRow+e-1).getType())return!0;if(e>1&&a.getType()==this.container.getChildAt(t*MapData.maxRow+e-2).getType())return!0}if(e<MapData.maxCol-2){if(t>0&&a.getType()==this.container.getChildAt((t-1)*MapData.maxRow+e+2).getType())return!0;if(t<MapData.maxRow-1&&a.getType()==this.container.getChildAt((t+1)*MapData.maxRow+e+2).getType())return!0;if(e<MapData.maxCol-3&&a.getType()==this.container.getChildAt(t*MapData.maxRow+e+3).getType())return!0}}if(t<MapData.maxRow-1&&a.getType()==this.container.getChildAt((t+1)*MapData.maxRow+e).getType()){if(t>0){if(e>0&&a.getType()==this.container.getChildAt((t-1)*MapData.maxRow+e-1).getType())return!0;if(e<MapData.maxCol-1&&a.getType()==this.container.getChildAt((t-1)*MapData.maxRow+e+1).getType())return!0;if(t>1&&a.getType()==this.container.getChildAt((t-2)*MapData.maxRow+e).getType())return!0}if(t<MapData.maxRow-2){if(e>0&&a.getType()==this.container.getChildAt((t+2)*MapData.maxRow+e-1).getType())return!0;if(e<MapData.maxCol-1&&a.getType()==this.container.getChildAt((t+2)*MapData.maxRow+e+1).getType())return!0;if(t<MapData.maxRow-3&&a.getType()==this.container.getChildAt((t+3)*MapData.maxRow+e).getType())return!0}}if(e<MapData.maxCol-2&&a.getType()==this.container.getChildAt(t*MapData.maxRow+e+2).getType()){if(t>0&&a.getType()==this.container.getChildAt((t-1)*MapData.maxRow+e+1).getType())return!0;if(t<MapData.maxRow-1&&a.getType()==this.container.getChildAt((t+1)*MapData.maxRow+e+1).getType())return!0}if(t<MapData.maxRow-2&&a.getType()==this.container.getChildAt((t+2)*MapData.maxRow+e).getType()){if(e>0&&a.getType()==this.container.getChildAt((t+1)*MapData.maxRow+e-1).getType())return!0;if(e<MapData.maxCol-1&&a.getType()==this.container.getChildAt((t+1)*MapData.maxRow+e+1).getType())return!0}}return!1},e.prototype.disOrder=function(){var t=MapData.maxRow*MapData.maxCol;egret.Tween.removeAllTweens();for(var e=0;t>e;e++){var a=this.container.getChildAt(e);a.setType(this.getRandomType()),a.dropDown(this.container.getChildIndex(a))}},e}(egret.EventDispatcher);__reflect(GameElementManagement.prototype,"GameElementManagement");var PropElementManagement=function(){function t(t){this.currentTap=-1,this.container=t;for(var e=0;5>e;e++){var a=new PropElement;this.container.addChildAt(a,e),a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)}this.init()}return t.prototype.init=function(){for(var t=0;5>t;t++){var e=this.container.getChildAt(t);e.setType(GameData.PropElements[t].type),e.setPropNum(GameData.PropElements[t].num),e.setX(t)}},t.prototype.onTouchTap=function(e){var a=e.currentTarget;this.currentTap==this.container.getChildIndex(a)?(a.focusEffect(!1),t.propType="",this.currentTap=-1):(-1!=this.currentTap&&this.container.getChildAt(this.currentTap).focusEffect(!1),a.focusEffect(!0),this.currentTap=this.container.getChildIndex(a),t.propType=a.getType())},t.prototype.useProp=function(e){var a=this.container.getChildAt(this.currentTap),n=a.getPropNum();switch(n>0&&a.setPropNum(n-1),a.focusEffect(!1),t.propType){case"same":this.samelyEliminate(e);break;case"cross":this.crosswiseEliminate(e);break;case"line":this.linelyEliminate(e);break;case"column":this.columnEliminate(e);break;case"single":this.singlyEliminate(e)}this.currentTap=-1,t.propType=""},t.prototype.samelyEliminate=function(t){for(var e=t.container.getChildAt(CustomizedEvent.currentTap).getType(),a=MapData.maxRow*MapData.maxCol,n=0;a>n;n++)t.container.getChildAt(n).getType()==e&&t.eliminates.push(n)},t.prototype.crosswiseEliminate=function(t){var e=Math.floor(CustomizedEvent.currentTap/MapData.maxCol),a=CustomizedEvent.currentTap%MapData.maxRow;t.eliminates.push(e*MapData.maxRow+a),e>0&&t.eliminates.push((e-1)*MapData.maxRow+a),e<MapData.maxRow-1&&t.eliminates.push((e+1)*MapData.maxRow+a),a>0&&t.eliminates.push(e*MapData.maxRow+a-1),a<MapData.maxCol-1&&t.eliminates.push(e*MapData.maxRow+a+1)},t.prototype.linelyEliminate=function(t){for(var e=Math.floor(CustomizedEvent.currentTap/MapData.maxCol),a=0;a<MapData.maxCol;a++)t.eliminates.push(e*MapData.maxRow+a)},t.prototype.columnEliminate=function(t){for(var e=CustomizedEvent.currentTap%MapData.maxRow,a=0;a<MapData.maxRow;a++)t.eliminates.push(a*MapData.maxRow+e)},t.prototype.singlyEliminate=function(t){t.eliminates.push(CustomizedEvent.currentTap)},t.propType="",t}();__reflect(PropElementManagement.prototype,"PropElementManagement");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(a){switch(a.label){case 0:return[4,this.loadResource()];case 1:return a.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=a.sent(),this.startAnimation(t),[4,platform.login()];case 3:return a.sent(),[4,platform.getUserInfo()];case 4:return e=a.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return a.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return a.sent(),this.stage.removeChild(t),[3,4];case 3:return e=a.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){GameData.stageW=this.stage.stageWidth,GameData.stageH=this.stage.stageHeight,GameData.ratio=this.stage.stageWidth/2024,MapData.gap=200*GameData.ratio,MapData.gridwidth=(GameData.stageW-2*MapData.gap)/MapData.maxCol,MapData.startY=(GameData.stageH-MapData.gridwidth*MapData.maxCol)/2,new GameLogic(this)},e.prototype.startAnimation=function(t){var e=this,a=new egret.HtmlTextParser,n=t.map(function(t){return a.parse(t)}),i=this.textfield,r=-1,o=function(){r++,r>=n.length&&(r=0);var t=n[r];i.textFlow=t;var a=egret.Tween.get(i);a.to({alpha:1},200),a.wait(2e3),a.to({alpha:0},200),a.call(o,e)};o()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var GameBackground=function(t){function e(){var a=t.call(this)||this,n=new egret.Bitmap(RES.getRes("background_png"));a.addChild(n),n.width=GameData.stageW,n.height=GameData.stageH;var i=new egret.Bitmap(RES.getRes("DodgerBlue_png"));a.addChild(i),i.width=GameData.stageW,i.height*=GameData.ratio,e.topHeight=i.height;var r=new egret.Bitmap(RES.getRes("LimeGreen_png"));a.addChild(r),r.width=GameData.stageW,r.height*=GameData.ratio,r.anchorOffsetY=r.height,r.y=GameData.stageH;for(var o=RES.getRes("DeepSkyBlue_png"),s=RES.getRes("DarkTurquoise_png"),p=0;p<MapData.maxRow;p++)for(var m=0;m<MapData.maxCol;m++){var h=new egret.Bitmap;a.addChild(h),h.width=MapData.gridwidth,h.height=MapData.gridwidth,h.x=MapData.gap+MapData.gridwidth*m,h.y=MapData.startY+MapData.gridwidth*p,p%2==0&&m%2==0||p%2==1&&m%2==1?h.texture=o:h.texture=s}return a.cacheAsBitmap=!0,a}return __extends(e,t),e}(egret.Sprite);__reflect(GameBackground.prototype,"GameBackground");var GameElement=function(t){function e(){var e=t.call(this)||this;e.type="";var a=12*GameData.ratio;e.touchEnabled=!1,e.touchChildren=!1,e.bitmap=new egret.Bitmap,e.addChild(e.bitmap),e.width=MapData.gridwidth-2*a,e.height=MapData.gridwidth-2*a,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.bitmap.width=e.width,e.bitmap.height=e.height;var n=RES.getRes("newParticle_png"),i=RES.getRes("newParticle_json");return e.system=new particle.GravityParticleSystem(n,i),e}return __extends(e,t),e.prototype.getType=function(){return this.type},e.prototype.setType=function(t){this.type=t,this.bitmap.texture=RES.getRes(t+"_png")},e.prototype.show=function(t){this.x=MapData.gap+MapData.gridwidth*(t%MapData.maxRow)+MapData.gridwidth/2,this.y=MapData.startY-this.width;var e=egret.Tween.get(this);e.wait(50*(MapData.maxRow*MapData.maxCol-t),!1);var a=MapData.startY+MapData.gridwidth*Math.floor(t/MapData.maxCol)+MapData.gridwidth/2;e.to({y:a},700,egret.Ease.bounceOut)},e.prototype.focusEffect=function(t){t?(this.addChild(this.system),this.system.emitterX=this.width/2,this.system.emitterY=this.height,this.system.start()):this.contains(this.system)&&(this.system.stop(),this.removeChild(this.system))},e.prototype.moveTo=function(t){var e=MapData.gap+MapData.gridwidth*(t%MapData.maxRow)+MapData.gridwidth/2,a=MapData.startY+MapData.gridwidth*Math.floor(t/MapData.maxCol)+MapData.gridwidth/2,n=egret.Tween.get(this);n.to({x:e,y:a},300,egret.Ease.cubicInOut).call(this.moveToAniOver,this)},e.prototype.moveToAniOver=function(){var t=new CustomizedEvent(CustomizedEvent.SWAP_ELEMENT);this.dispatchEvent(t)},e.prototype.moveToRequiredElement=function(t){var e=egret.Tween.get(this);e.to({x:t.x,y:t.y},700,egret.Ease.quadOut).call(this.eliminateOver,this)},e.prototype.eliminateOver=function(){this.parent.contains(this)&&this.setType("");var t=new CustomizedEvent(CustomizedEvent.ELIMINATE_OVER);this.dispatchEvent(t)},e.prototype.scaleAndRemove=function(){var t=egret.Tween.get(this);t.to({scaleX:1.4,scaleY:1.4},300,egret.Ease.cubicInOut).to({scaleX:.1,scaleY:.1},300,egret.Ease.cubicInOut).call(this.eliminateOver,this)},e.prototype.moveDown=function(t){var e=MapData.startY+MapData.gridwidth*Math.floor(t/MapData.maxCol)+MapData.gridwidth/2,a=egret.Tween.get(this);a.to({y:e},300,egret.Ease.cubicInOut).call(this.dropDownOver,this)},e.prototype.dropDown=function(t){var e=MapData.gap+MapData.gridwidth*(t%MapData.maxRow)+MapData.gridwidth/2,a=MapData.startY+MapData.gridwidth*Math.floor(t/MapData.maxCol)+MapData.gridwidth/2;this.x=e,this.y=MapData.startY-this.width,this.scaleX=1,this.scaleY=1;var n=egret.Tween.get(this);n.to({y:a},700,egret.Ease.bounceOut).call(this.dropDownOver,this)},e.prototype.dropDownOver=function(){var t=new CustomizedEvent(CustomizedEvent.AUTO_ELIMINATE);this.dispatchEvent(t)},e}(egret.Sprite);__reflect(GameElement.prototype,"GameElement");var GameLogic=function(){function t(t){this.swapElementNum=0,this.container=t;var e=new GameBackground;this.container.addChild(e);var a=new egret.DisplayObjectContainer;this.container.addChild(a),this.requiredElementManagement=new RequiredElementManagement(a),this.stepNumText=new StepNumText(this.container),this.stepNumText.setNum(20);var n=new egret.Sprite;this.container.addChild(n),this.propElementManagement=new PropElementManagement(n);var i=new egret.DisplayObjectContainer;this.container.addChild(i),this.gameElementManagement=new GameElementManagement(i),this.gameElementManagement.createElements(),this.gameoverpanel=new GameOverPanel,this.container.addChild(this.gameoverpanel),this.gameoverpanel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRestart,this),this.gameElementManagement.addEventListener(CustomizedEvent.TAP_TWO_ELEMENT,this.onTapTwoElement,this),this.gameElementManagement.addEventListener(CustomizedEvent.SWAP_ELEMENT,this.swapElementHandler,this),this.gameElementManagement.addEventListener(CustomizedEvent.ELIMINATE_OVER,this.onEliminateOver,this),this.gameElementManagement.addEventListener(CustomizedEvent.AUTO_ELIMINATE,this.autoEliminate,this),this.gameElementManagement.addEventListener(CustomizedEvent.USE_PROP_CLICK,this.usePropClick,this)}return t.prototype.onTapTwoElement=function(t){this.gameElementManagement.container.getChildAt(CustomizedEvent.currentTap).focusEffect(!1),this.gameElementManagement.canMove()?this.gameElementManagement.playSwapElement():(this.gameElementManagement.container.getChildAt(CustomizedEvent.anotherTap).focusEffect(!0),CustomizedEvent.currentTap=CustomizedEvent.anotherTap)},t.prototype.swapElementHandler=function(){this.swapElementNum++;var t=this.gameElementManagement.container;if(t.swapChildren(t.getChildAt(CustomizedEvent.currentTap),t.getChildAt(CustomizedEvent.anotherTap)),2==this.swapElementNum)this.swapElementNum=0,CustomizedEvent.currentTap=-1;else if(this.gameElementManagement.collectEliminates(),this.gameElementManagement.eliminates.length>0){this.gameElementManagement.container.touchChildren=!1,this.propElementManagement.container.touchChildren=!1,this.swapElementNum=0,this.eliminateElements();var e=this.stepNumText.getNum();this.stepNumText.setNum(e-1)}else this.gameElementManagement.playSwapElement()},t.prototype.eliminateElements=function(){for(var t=this.gameElementManagement.eliminates.length,e=0;t>e;e++){var a=this.gameElementManagement.eliminates[e],n=this.gameElementManagement.container.getChildAt(a).getType(),i=this.requiredElementManagement.isRequiredElementType(n);if(i){var r=this.requiredElementManagement.getPointByType(n);this.requiredElementManagement.updateNumText(n,1),this.gameElementManagement.playMoveToRequiredElement(a,r)}else this.gameElementManagement.playScaleAndRemove(a)}},t.prototype.onEliminateOver=function(){CustomizedEvent.currentTap=-1,this.gameElementManagement.dropDownAndNewElement()},t.prototype.autoEliminate=function(t){this.gameElementManagement.collectEliminates(),this.gameElementManagement.eliminates.length>0?this.eliminateElements():this.gameElementManagement.isHaveSeries()||this.gameElementManagement.disOrder(),this.gameElementManagement.container.touchChildren=!0,this.propElementManagement.container.touchChildren=!0,0!=this.stepNumText.getNum()||this.requiredElementManagement.isAllElementEliminated()||(this.gameoverpanel.show(),this.gameElementManagement.container.touchChildren=!1,this.propElementManagement.container.touchChildren=!1)},t.prototype.onRestart=function(){this.gameoverpanel.y=-GameData.stageH/2,this.requiredElementManagement.init(),this.stepNumText.setNum(20),this.gameElementManagement.container.touchChildren=!0,this.propElementManagement.container.touchChildren=!0,this.gameElementManagement.createElements(),this.propElementManagement.init()},t.prototype.usePropClick=function(){this.gameElementManagement.eliminates=[],this.propElementManagement.useProp(this.gameElementManagement),this.gameElementManagement.eliminates.length>0&&this.eliminateElements()},t}();__reflect(GameLogic.prototype,"GameLogic");var GameOverPanel=function(t){function e(){var e=t.call(this)||this,a=new egret.Bitmap;e.addChild(a),a.texture=RES.getRes("game_over_panel_png");var n=a.width/a.height;return a.width=GameData.stageW/2,a.height=a.width/n,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=GameData.stageW/2,e.y=-GameData.stageH/2,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.show=function(){var t=egret.Tween.get(this);t.to({y:GameData.stageH/2},700,egret.Ease.bounceOut)},e}(egret.Sprite);__reflect(GameOverPanel.prototype,"GameOverPanel");var PropElement=function(t){function e(){var e=t.call(this)||this;e.type="",e.touchEnabled=!0,e.bitmap=new egret.Bitmap,e.addChild(e.bitmap),e.gap=150*GameData.ratio;var a=(GameData.stageW-6*e.gap)/5;e.bitmap.width=a,e.bitmap.height=a,e.numText=new egret.TextField,e.addChild(e.numText),e.numText.fontFamily="方正大黑简体",e.numText.size=100*GameData.ratio,e.numText.width=a,e.numText.textAlign=egret.HorizontalAlign.CENTER,e.width=a,e.height=e.bitmap.height+e.numText.height,e.anchorOffsetY=e.height/2,e.y=GameData.stageH-GameBackground.topHeight/2-20,e.numText.y=e.bitmap.height-40;var n=RES.getRes("newParticle_png"),i=RES.getRes("newParticle_json");return e.system=new particle.GravityParticleSystem(n,i),e}return __extends(e,t),e.prototype.getType=function(){return this.type},e.prototype.setType=function(t){this.type=t,this.bitmap.texture=RES.getRes(this.type+"_png")},e.prototype.getPropNum=function(){return this.propNum},e.prototype.setPropNum=function(t){this.propNum=t,this.numText.text="×"+t},e.prototype.setX=function(t){this.x=this.gap+(this.gap+this.width)*t},e.prototype.focusEffect=function(t){t?(this.addChild(this.system),this.system.emitterX=this.width/2,this.system.emitterY=this.height,this.system.start()):this.contains(this.system)&&(this.system.stop(),this.removeChild(this.system))},e}(egret.Sprite);__reflect(PropElement.prototype,"PropElement");var RequiredElement=function(t){function e(){var e=t.call(this)||this;e.type="",e.gap=80*GameData.ratio,e.touchChildren=!1,e.bitmap=new egret.Bitmap,e.addChild(e.bitmap),e.gap=80*GameData.ratio;var a=(GameData.stageW/2-5*e.gap)/4;return e.bitmap.width=a,e.bitmap.height=a,e.numText=new egret.TextField,e.addChild(e.numText),e.numText.size=64*GameData.ratio,e.numText.width=a,e.numText.textAlign=egret.HorizontalAlign.CENTER,e.numText.y=a-20,e.numText.fontFamily="方正大黑简体",e.width=e.bitmap.width,e.height=e.bitmap.height+e.numText.textHeight/2,e.anchorOffsetY=e.height/2,e.y=GameBackground.topHeight/2-10,e}return __extends(e,t),e.prototype.getType=function(){return this.type},e.prototype.setType=function(t){this.type=t,this.bitmap.texture=RES.getRes(this.type+"_png")},e.prototype.getReqNum=function(){return this.reqNum},e.prototype.setReqNum=function(t){this.reqNum=t,this.numText.text="×"+t},e.prototype.setX=function(t){this.x=this.gap+(this.gap+this.width)*t},e}(egret.Sprite);__reflect(RequiredElement.prototype,"RequiredElement");var StepNumText=function(){function t(t){this.container=t;var e=new egret.TextField;this.container.addChild(e),e.textColor=16776960,e.fontFamily="方正大黑简体",e.height=GameBackground.topHeight,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.size=160*GameData.stageW/2024,e.text="Moves",this.stepText=new egret.TextField,this.container.addChild(this.stepText),this.stepText.fontFamily="方正大黑简体",this.stepText.size=160*GameData.stageW/2024,this.stepText.height=GameBackground.topHeight,this.stepText.verticalAlign=egret.VerticalAlign.MIDDLE;var a=(GameData.stageW/2-e.width)/4*GameData.ratio;e.x=GameData.stageW/2+a,this.stepText.x=e.x+e.width}return t.prototype.getNum=function(){return this.stepNum},t.prototype.setNum=function(t){this.stepNum=t,this.stepText.text="×"+this.stepNum},t}();__reflect(StepNumText.prototype,"StepNumText");